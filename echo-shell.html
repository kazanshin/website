<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>echo-shell</title>
</head>
<body>

<pre id="status">locked</pre>

<textarea id="msg" rows="6" cols="80" placeholder="message"></textarea>
<br>
<button id="send">send</button>

<div id="out" style="
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: anywhere;
  max-width: 900px;
  font-family: monospace;
  border: 1px solid #ccc;
  padding: 10px;
  margin-top: 10px;
"></div>

<script>
let secret = "";

function unlock() {
  const p = prompt("passphrase:");
  if (!p) return;
  secret = p;
  document.getElementById("status").textContent = "unlocked";
}

unlock();

async function send() {
  const box = document.getElementById("msg");
  const message = box.value.trim();
  if (!message) return;

  const out = document.getElementById("out");
  out.textContent = "sending...";

  const r = await fetch("/api/echo", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-echo-secret": secret
    },
    body: JSON.stringify({ message })
  });

  const j = await r.json();

  // âœ… FIX: display reply instead of raw JSON
  out.textContent = j.reply || "(no reply)";

  box.value = "";
  window.scrollTo(0, document.body.scrollHeight);
}

document.getElementById("send").onclick = send;

document.getElementById("msg").addEventListener("keydown", e => {
  if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    send();
  }
});
</script>

</body>
</html>
